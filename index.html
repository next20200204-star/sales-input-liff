<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>日次売上報告</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 16px;
      background: #f7f7f7;
      font-size: 18px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    h1 {
      font-size: 24px;
      margin-top: 0;
      margin-bottom: 20px;
      text-align: center;
    }

    label {
      display: block;
      margin-top: 14px;
      margin-bottom: 6px;
      font-weight: bold;
    }

    input, textarea, button {
      width: 100%;
      box-sizing: border-box;
      font-size: 18px;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    button {
      margin-top: 24px;
      background: #06c755;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }

    button:disabled {
      background: #9ddfb9;
      cursor: not-allowed;
    }

    .message {
      margin-top: 16px;
      font-weight: bold;
      text-align: center;
    }

    .error {
      color: #d93025;
    }

    .success {
      color: #188038;
    }

    .note {
      font-size: 14px;
      color: #666;
      margin-top: 6px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>日次売上報告</h1>

    <label for="salesDate">売上日</label>
    <input type="date" id="salesDate">

    <label for="storeCode">店舗コード</label>
    <input type="text" id="storeCode" readonly>

    <label for="storeName">店舗名</label>
    <input type="text" id="storeName" readonly>

    <label for="totalSales">売上合計</label>
    <input type="number" id="totalSales" inputmode="numeric">

    <label for="note">備考（任意）</label>
    <textarea id="note" placeholder="必要な場合のみ入力"></textarea>

    <button id="submitButton" onclick="submitSales()">送信する</button>

    <div id="message" class="message"></div>
    <div class="note">※ 店舗はQRコードから自動判定されます</div>
  </div>

  <iframe name="hiddenFrame" style="display:none;"></iframe>

  <script>
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxzTQ_iDPaMM1CEuWhIRI6PaQTllyMFTxqDAt86loEmmX3r7pbbqUfDxCK_9qddch7feQ/exec';

    const STORE_MAP = {
      '1300': '久留米本店',
      '1301': 'FLAG天神',
      '1303': '新宮',
      '1304': '曽根バイパス',
      '1311': '都城川東',
      '1312': '佐賀西',
      '1318': '日向',
      '1320': '大塔',
      '1321': '玉名',
      '1324': '志免',
      '1328': '島原',
      '1332': '稲佐',
      '1333': '柳川',
      '1336': '宇佐',
      '1338': '中山',
      '1341': '高鍋',
      '1345': '大牟田北',
      '1346': '宮崎北バイパス',
      '1347': '熊本浜線',
      '1352': '大分三重',
      '1353': '伊万里',
      '1354': '甘木',
      '1356': 'コスタ行橋',
      '1364': '佐賀兵庫',
      '1365': '吉野',
      '1366': '日田',
      '1367': 'シュロアモール筑紫野',
      '1370': '八女',
      '1371': '中津',
      '1374': '春日',
      '1377': '大村',
      '1415': 'SS姶良',
      '1420': 'SS与次郎',
      '1434': 'SSマークイズ',
      '1436': 'SSゆめタウン光の森',
      '1437': 'SS浦添',
      '1440': 'SSサクラマチ',
      '1445': 'SSゆめタウン久留米',
      '1450': 'SSアミュ鹿児島',
      '1451': 'SSアミュ宮崎',
      '1453': 'SS天神',
      '1454': 'SSアミュ熊本',
      '1467': 'SS飯塚',
      '1527': 'SS天神フタタビル',
      '1530': 'SS博多',
      '1531': 'SS小倉',
      '1533': 'SS長崎ココウォーク',
      '1553': 'SS佐世保',
      '1574': 'SS博多駅前',
      '1576': 'SSモラージュ佐賀',
      '1604': 'SSゆめタウンはません',
      '1618': 'SS久留米',
      '1621': 'SS長崎浜町',
      '1623': 'SS鹿児島中央',
      '1625': 'SSスクエアモール（宇宿）',
      '1647': 'SSアミュ大分',
      '1650': 'SS那覇',
      '1651': 'SSゆめタウン別府',
      '1653': 'SSゆめタウン山口',
      '1657': 'SS香椎',
      '1658': 'SSゆめタウン大牟田',
      '1659': 'SSゆめタウン行橋',
      '1663': 'SSわさだ',
      '1678': 'SSゆめタウン筑紫野',
      '1680': 'SS下関',
      '1682': 'SS姪浜',
      '1683': 'SS徳山',
      '1691': 'SS宇部',
      '1718': 'DF天神地下街',
      '1736': 'DFアミュ大分',
      '1746': 'DF鹿児島',
      '1747': 'DF長崎ココウォーク',
      '1758': 'DFマークイズ',
      '1760': 'DF浦添',
      '1761': 'DFサクラマチ',
      '1765': 'DF宮崎',
      '1778': 'DFアミュ博多',
      '1780': 'DF小倉'
    };

    function setToday() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('salesDate').value = today;
    }

    function showMessage(text, isError = false) {
      const message = document.getElementById('message');
      message.textContent = text;
      message.className = 'message ' + (isError ? 'error' : 'success');
    }

    function setStoreFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const storeCode = params.get('store');

      if (!storeCode) {
        showMessage('店舗コードがありません', true);
        document.getElementById('submitButton').disabled = true;
        return false;
      }

      const storeName = STORE_MAP[storeCode];

      if (!storeName) {
        showMessage('店舗コードが正しくありません', true);
        document.getElementById('submitButton').disabled = true;
        return false;
      }

      document.getElementById('storeCode').value = storeCode;
      document.getElementById('storeName').value = storeName;
      return true;
    }

    function validateInput(data) {
      if (!data.salesDate) return '売上日を入力してください';
      if (!data.totalSales) return '売上合計を入力してください';

      const total = Number(data.totalSales);
      if (isNaN(total)) {
        return '売上合計は数字で入力してください';
      }

      return '';
    }

    function submitSales() {
      const button = document.getElementById('submitButton');
      button.disabled = true;
      showMessage('');

      const data = {
        salesDate: document.getElementById('salesDate').value,
        storeCode: document.getElementById('storeCode').value,
        storeName: document.getElementById('storeName').value,
        totalSales: document.getElementById('totalSales').value,
        note: document.getElementById('note').value,
        inputUser: ''
      };

      const errorMessage = validateInput(data);
      if (errorMessage) {
        showMessage(errorMessage, true);
        button.disabled = false;
        return;
      }

      try {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = WEB_APP_URL;
        form.target = 'hiddenFrame';
        form.style.display = 'none';

        Object.keys(data).forEach((key) => {
          const input = document.createElement('input');
          input.type = 'hidden';
          input.name = key;
          input.value = data[key];
          form.appendChild(input);
        });

        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);

        showMessage('登録しました');

        document.getElementById('totalSales').value = '';
        document.getElementById('note').value = '';

        setTimeout(() => {
          button.disabled = false;
        }, 1000);

      } catch (error) {
        console.error(error);
        showMessage('送信に失敗しました。通信状態をご確認ください。', true);
        button.disabled = false;
      }
    }

    setToday();
    setStoreFromUrl();
  </script>
</body>
</html>
